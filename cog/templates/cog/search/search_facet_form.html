{% extends "cog/common/layout_sidebar_center_right.html" %}

{% block main %}

    {% load cog_utils %}
    
	<!-- facet form -->
	<div class="mybox">
	  <form method="POST" action="" id="facetForm">
	
	    {% csrf_token %}
	    <table>
	        <tr>
	            <td valign="top" nowrap="nowrap"><b>Facet Key</b></td>
	            <td class="long">{{ form.key }} {{ form.key.errors }}</td>
	        </tr>
            <tr>
                <td valign="top" nowrap="nowrap">&nbsp;</td>
                <td class="long"><i>The metadata key used by the search engine. Available keys and associated values are listed below. </i></td>
            </tr>	        
	        <tr>
	            <td valign="top" nowrap="nowrap"><b>Facet Label</b></td>
	            <td class="long">{{ form.label }} {{ form.label.errors }}</td>
	        </tr>
	        <tr>
                <td valign="top" nowrap="nowrap">&nbsp;</td>
                <td class="long"><i>The facet label displayed in the user interface.</i></td>
            </tr>           
            <tr>
                <td class="long" colspan="2"><i>Please note: the characters {{ project|getInvalidCharacters }} are not allowed.</i></td>
            </tr>           	        
	    </table> 
	    
	    <!-- fields not editable by the user -->
	    {{ form.order.as_hidden }}
	    {{ form.group.as_hidden }}
	    	    
	    <div style="text-align:right">
	        <input type="button" value="Cancel" onclick="window.location='{% url 'search_profile_config' project.short_name|lower %}'"/>
	        <input type="submit" value="Submit" />
	    </div>          
	    
	  </form>
	</div>
	
	<!-- table of available facets table -->
    {% if facets %}
	    
	    <!-- list search facets  -->
	    <div class="mybox">
            <table>
                <caption>Available search facet keys, their associated values.</caption>
                {% for keyAndFacet in facets|sortdict %}
                	<!-- only display facets that have some values -->
                	{% if keyAndFacet.1.values %}
	                    <tr>
	                       <td nowrap="nowrap">{{ keyAndFacet.0 }}</td>
	                       <td>     
	                       	<!-- limit display to first 20 values -->     
	                       	{% for value in keyAndFacet.1.values.keys|slice:":20" %}
	                       		{% if forloop.counter > 1 %}, {% endif %}
	                       		{{ value|truncatechars:50 }} ({{ keyAndFacet.1.values|dictKeyLookup:value }})
	                       	{% endfor %}
	                       	<!-- there are more values -->
	                       	{% if keyAndFacet.1.values.keys|length > 20 %}, ...... {% endif %}
	                       </td>
	                    </tr>
                    {% endif %}
                {% endfor %}   
            </table>
         </div>       
    {% endif %}
		
{% endblock %}